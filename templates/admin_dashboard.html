{% extends "base.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block styles %}
<style>
    /* Premium styling enhancements */
    .card {
        border-radius: 0.75rem;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
        border: none;
        overflow: hidden;
    }

    .card:hover {
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
    }

    .card-header {
        border-top-left-radius: 0.75rem !important;
        border-top-right-radius: 0.75rem !important;
        background: linear-gradient(to right, var(--primary), #c95659);
        color: white;
        border: none;
    }

    .card-header.secondary {
        background: linear-gradient(to right, var(--secondary), #307f80);
    }

    .stats-card {
        min-height: 160px;
        display: flex;
        flex-direction: column;
    }

    .stats-card .icon {
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 12px;
        margin-bottom: 1rem;
    }

    .stats-card .icon.primary {
        background-color: rgba(173, 66, 69, 0.1);
        color: var(--primary);
    }

    .stats-card .icon.secondary {
        background-color: rgba(35, 100, 101, 0.1);
        color: var(--secondary);
    }

    .stats-card .icon.success {
        background-color: rgba(25, 135, 84, 0.1);
        color: #198754;
    }

    .stats-card .icon.warning {
        background-color: rgba(255, 193, 7, 0.1);
        color: #ffc107;
    }

    .stats-card .icon i {
        font-size: 1.5rem;
    }

    .stats-card .stat-value {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
    }

    .stats-card .stat-label {
        color: #6c757d;
        font-size: 0.9rem;
    }

    .progress {
        height: 8px;
        border-radius: 4px;
        margin-top: 0.5rem;
        margin-bottom: 0.5rem;
    }

    .progress-bar.bg-primary {
        background: linear-gradient(to right, var(--primary), #c95659) !important;
    }

    .progress-bar.bg-secondary {
        background: linear-gradient(to right, var(--secondary), #307f80) !important;
    }

    .rating-pill {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 50px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .rating-pill.high {
        background-color: rgba(25, 135, 84, 0.1);
        color: #198754;
    }

    .rating-pill.medium {
        background-color: rgba(255, 193, 7, 0.1);
        color: #ffc107;
    }

    .rating-pill.low {
        background-color: rgba(173, 66, 69, 0.1);
        color: var(--primary);
    }

    .table thead th {
        background-color: rgba(35, 100, 101, 0.1);
        color: var(--secondary);
        font-weight: 600;
        border: none;
    }

    .table tbody tr:nth-child(even) {
        background-color: rgba(248, 249, 250, 0.5);
    }

    .table-hover tbody tr:hover {
        background-color: rgba(173, 66, 69, 0.05);
    }

    .btn-premium {
        background: linear-gradient(to right, var(--secondary), #307f80);
        color: white;
        border: none;
        box-shadow: 0 4px 10px rgba(35, 100, 101, 0.2);
        transition: all 0.3s ease;
    }

    .btn-premium:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(35, 100, 101, 0.3);
        color: white;
    }

    .btn-danger-soft {
        background-color: rgba(173, 66, 69, 0.1);
        color: var(--primary);
        border: none;
    }

    .btn-danger-soft:hover {
        background-color: var(--primary);
        color: white;
    }

    .date-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 50px;
        font-size: 0.85rem;
        font-weight: 500;
    }

    .date-badge.scheduled {
        background-color: rgba(25, 135, 84, 0.1);
        color: #198754;
        border: 1px solid rgba(25, 135, 84, 0.2);
    }

    .date-badge.not-scheduled {
        background-color: rgba(173, 66, 69, 0.1);
        color: var(--primary);
        border: 1px solid rgba(173, 66, 69, 0.2);
    }

    /* Animation classes */
    .fade-in {
        animation: fadeIn 0.5s ease-in-out forwards;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Stats counter animation */
    .stat-count {
        animation: countUp 2s ease-out forwards;
    }

    @keyframes countUp {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Charts container */
    .chart-container {
        position: relative;
        height: 280px;
        width: 100%;
    }

    /* Faculty status circle */
    .status-circle {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 5px;
    }

    .status-active {
        background-color: #198754;
    }

    .status-inactive {
        background-color: #6c757d;
    }

    /* Student list enhancements */
    .student-card {
        transition: all 0.2s ease;
    }

    .student-card:hover {
        transform: translateY(-3px);
    }

    .rating-badge {
        font-size: 0.8rem;
        font-weight: 700;
        padding: 0.35rem 0.65rem;
        border-radius: 50px;
    }

    .rating-stars {
        color: #ffc107;
        letter-spacing: -2px;
    }

    .search-container {
        position: relative;
    }

    .search-container .form-control {
        padding-left: 2.5rem;
        border-radius: 50px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .search-container .search-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #6c757d;
    }

    .filters-container {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }

    .filter-pill {
        background-color: rgba(35, 100, 101, 0.1);
        border: 1px solid rgba(35, 100, 101, 0.2);
        color: var(--secondary);
        border-radius: 50px;
        padding: 0.35rem 0.75rem;
        font-size: 0.85rem;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .filter-pill:hover, .filter-pill.active {
        background-color: var(--secondary);
        color: white;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Header section with title -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 bg-white shadow-sm">
                <div class="card-body p-4">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h3 class="fw-bold text-secondary mb-2">Admin Dashboard</h3>
                            <p class="text-muted mb-0">Manage faculty instructors and monitor hiring metrics</p>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-premium" id="refresh-data">
                                <i class="fas fa-sync-alt me-2"></i> Refresh Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Key metrics cards -->
    <div class="row mb-4">
        <!-- Total Faculty -->
        <div class="col-xl-4 col-md-6 mb-4">
            <div class="card h-100 stats-card">
                <div class="card-body p-4">
                    <div class="icon primary">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <h4 class="stat-value text-primary" id="total-faculty">0</h4>
                    <p class="stat-label mb-0">Total Faculty</p>
                    <div class="progress">
                        <div class="progress-bar bg-primary" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <p class="text-muted small mb-0 mt-2">All registered faculty instructors</p>
                </div>
            </div>
        </div>

        <!-- Faculty with Scheduled Interviews -->
        <div class="col-xl-4 col-md-6 mb-4">
            <div class="card h-100 stats-card">
                <div class="card-body p-4">
                    <div class="icon secondary">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <h4 class="stat-value text-secondary" id="scheduled-faculty">0</h4>
                    <p class="stat-label mb-0">Faculty with Schedules</p>
                    <div class="progress">
                        <div class="progress-bar bg-secondary" role="progressbar" style="width: 0%" id="scheduled-progress" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <p class="text-muted small mb-0 mt-2"><span id="scheduling-percent">0%</span> of faculty have set interview dates</p>
                </div>
            </div>
        </div>

        <!-- Total Candidates -->
        <div class="col-xl-4 col-md-12 mb-4">
            <div class="card h-100 stats-card">
                <div class="card-body p-4">
                    <div class="icon success">
                        <i class="fas fa-users"></i>
                    </div>
                    <h4 class="stat-value text-success" id="total-candidates">0</h4>
                    <p class="stat-label mb-0">Total Candidates</p>
                    <div class="progress">
                        <div class="progress-bar bg-success" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <p class="text-muted small mb-0 mt-2">All applicants in the system</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="row mb-4">
        <!-- Faculty Status Chart -->
        <div class="col-xl-6 mb-4">
            <div class="card h-100">
                <div class="card-header py-3">
                    <h5 class="mb-0 fw-bold text-white">Faculty Interview Scheduling Status</h5>
                </div>
                <div class="card-body p-4">
                    <div class="chart-container">
                        <canvas id="faculty-status-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ratings Distribution Chart -->
        <div class="col-xl-6 mb-4">
            <div class="card h-100">
                <div class="card-header py-3 secondary">
                    <h5 class="mb-0 fw-bold text-white">Candidate Ratings Distribution</h5>
                </div>
                <div class="card-body p-4">
                    <div class="chart-container">
                        <canvas id="ratings-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Faculty List -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header py-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 fw-bold text-white">Faculty Instructors</h5>
                        <div>
                            <div class="input-group">
                                <input type="text" class="form-control" placeholder="Search faculty..." id="faculty-search">
                                <button class="btn btn-light" type="button">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Interview Date</th>
                                    <th>Scheduled Candidates</th>
                                    <th class="text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="faculty-table-body">
                                <!-- Will be populated by JavaScript -->
                                <tr>
                                    <td colspan="5" class="text-center py-4">
                                        <div class="spinner-border text-secondary" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                        <p class="text-muted mt-2 mb-0">Loading faculty data...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer bg-white py-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <span class="text-muted">Showing <span id="faculty-count">0</span> faculty</span>
                        </div>
                        <div>
                            <button class="btn btn-danger-soft">
                                <i class="fas fa-file-pdf me-1"></i> Export Report
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Candidates List (New Section) -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header py-3 secondary">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 fw-bold text-white">All Candidates</h5>
                        <div class="search-container">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="form-control" placeholder="Search candidates..." id="candidate-search">
                        </div>
                    </div>
                </div>
                <div class="card-body p-3">
                    <div class="filters-container">
                        <div class="filter-pill active" data-filter="all">All Candidates</div>
                        <div class="filter-pill" data-filter="high">Highly Rated (4+)</div>
                        <div class="filter-pill" data-filter="medium">Medium Rated (3-4)</div>
                        <div class="filter-pill" data-filter="low">Low Rated (<3)</div>
                        <div class="filter-pill" data-filter="unrated">Unrated</div>
                    </div>

                    <div class="row" id="candidates-container">
                        <!-- Will be populated by JavaScript -->
                        <div class="col-12 text-center py-4">
                            <div class="spinner-border text-secondary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="text-muted mt-2 mb-0">Loading candidate data...</p>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-white py-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <span class="text-muted">Showing <span id="candidates-count">0</span> candidates</span>
                        </div>
                        <button class="btn btn-premium" id="load-more-candidates">
                            <i class="fas fa-plus-circle me-1"></i> Load More
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Upcoming Interviews Card -->
    <div class="row">
        <div class="col-12 mb-4">
            <div class="card">
                <div class="card-header py-3">
                    <h5 class="mb-0 fw-bold text-white">Upcoming Interviews</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table mb-0">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Faculty</th>
                                    <th>Candidates</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="upcoming-interviews-body">
                                <!-- Will be populated by JavaScript -->
                                <tr>
                                    <td colspan="4" class="text-center py-4">
                                        <p class="text-muted mb-0">Loading upcoming interviews...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Faculty Details Modal -->
<div class="modal fade" id="facultyDetailsModal" tabindex="-1" aria-labelledby="facultyDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content border-0 shadow">
            <div class="modal-header py-3" style="background: linear-gradient(to right, var(--primary), #c95659); color: white;">
                <h5 class="modal-title fw-bold" id="faculty-modal-name">Faculty Details</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4">
                <div class="row mb-4">
                    <div class="col-md-6">
                        <h6 class="text-secondary mb-2">Contact Information</h6>
                        <p class="mb-1"><strong>Email:</strong> <span id="modal-faculty-email"></span></p>
                        <p class="mb-0"><strong>User ID:</strong> <span id="modal-faculty-id"></span></p>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-secondary mb-2">Status</h6>
                        <div id="modal-schedule-status"></div>
                    </div>
                </div>

                <div class="mb-4">
                    <h6 class="text-secondary mb-2">Scheduled Candidates</h6>
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Course</th>
                                </tr>
                            </thead>
                            <tbody id="modal-candidates-list">
                                <tr>
                                    <td colspan="2" class="text-center py-3">
                                        <p class="text-muted mb-0">No candidates scheduled</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-secondary mb-2">Activity</h6>
                        <p class="mb-1"><strong>Last Login:</strong> <span id="modal-last-login">N/A</span></p>
                        <p class="mb-0"><strong>Account Created:</strong> <span id="modal-created-date">N/A</span></p>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-premium">
                    <i class="fas fa-envelope me-1"></i> Send Email
                </button>
                <button type="button" class="btn btn-danger-soft">
                    <i class="fas fa-user-cog me-1"></i> Manage Access
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Candidate Details Modal -->
<div class="modal fade" id="candidateDetailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content border-0 shadow">
            <div class="modal-header py-3" style="background: linear-gradient(to right, var(--secondary), #307f80); color: white;">
                <h5 class="modal-title fw-bold" id="candidate-modal-name">Candidate Details</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4">
                <div class="row mb-4">
                    <div class="col-md-6">
                        <h6 class="text-secondary mb-2">Candidate Information</h6>
                        <p class="mb-1"><strong>ID:</strong> <span id="modal-candidate-id"></span></p>
                        <p class="mb-0"><strong>Average Rating:</strong> <span id="modal-candidate-rating"></span></p>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-secondary mb-2">Interests</h6>
                        <div id="modal-candidate-interests"></div>
                    </div>
                </div>

                <div class="mb-4">
                    <h6 class="text-secondary mb-2">Faculty Ratings</h6>
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Faculty</th>
                                    <th>Rating</th>
                                    <th>Comment</th>
                                </tr>
                            </thead>
                            <tbody id="modal-ratings-list">
                                <tr>
                                    <td colspan="3" class="text-center py-3">
                                        <p class="text-muted mb-0">No ratings yet</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="mb-4">
                    <h6 class="text-secondary mb-2">Interview Schedule</h6>
                    <div id="modal-candidate-schedule">
                        <p class="text-muted">Not scheduled for any interviews</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-premium" id="view-candidate-documents">
                    <i class="fas fa-file-alt me-1"></i> View Documents
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Toast container for notifications -->
<div id="toast-container" class="position-fixed bottom-0 end-0 p-3"></div>
{% endblock %}

{% block scripts %}
<!-- Chart.js for visualizations -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        // Load data
        loadDashboardData();

        // Initialize event listeners
        initEventListeners();

        // Initialize charts
        initCharts();
    });

    // Export report button
    document.querySelector('.btn-danger-soft').addEventListener('click', function() {
        exportFacultyReport();
    });

    // Initialize event listeners
    function initEventListeners() {
        // Refresh data button
        document.getElementById('refresh-data').addEventListener('click', function() {
            loadDashboardData();
            showToast('Dashboard data refreshed', 'success');
        });

        // Faculty search
        document.getElementById('faculty-search').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            filterFacultyTable(searchTerm);
        });

        // Candidate search
        document.getElementById('candidate-search').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            filterCandidates(searchTerm);
        });

        // Candidate filters
        document.querySelectorAll('.filter-pill').forEach(pill => {
            pill.addEventListener('click', function() {
                // Remove active class from all pills
                document.querySelectorAll('.filter-pill').forEach(p => p.classList.remove('active'));
                // Add active class to clicked pill
                this.classList.add('active');
                // Apply filter
                filterCandidatesByRating(this.dataset.filter);
            });
        });

        // Load more candidates button
        document.getElementById('load-more-candidates').addEventListener('click', function() {
            loadMoreCandidates();
        });
    }

    // Load dashboard data from API
    function loadDashboardData() {
        fetch('/api/admin/dashboard_stats')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                updateDashboardStats(data);
            })
            .catch(error => {
                console.error('Error fetching dashboard data:', error);
                showToast('Error loading dashboard data', 'error');

                // Load sample data as fallback
                loadSampleData();
            });
    }

    // Update dashboard with API data
    function updateDashboardStats(data) {
        // Update faculty stats
        document.getElementById('total-faculty').textContent = data.faculty.total;
        document.getElementById('scheduled-faculty').textContent = data.faculty.scheduled;
        document.getElementById('scheduling-percent').textContent = data.faculty.schedulingPercent + '%';

        // Update progress bar
        document.getElementById('scheduled-progress').style.width = data.faculty.schedulingPercent + '%';
        document.getElementById('scheduled-progress').setAttribute('aria-valuenow', data.faculty.schedulingPercent);

        // Update candidate stats
        document.getElementById('total-candidates').textContent = data.candidates.total;

        // Populate faculty table
        populateFacultyTable(data.faculty.data);
        document.getElementById('faculty-count').textContent = data.faculty.data.length;

        // Populate candidates grid
        populateCandidatesGrid(data.candidates.allCandidates || generateSampleCandidates());
        document.getElementById('candidates-count').textContent = (data.candidates.allCandidates || []).length;

        // Populate upcoming interviews table
        populateUpcomingInterviewsTable(data.interviews.upcoming);

        // Update charts
        updateFacultyStatusChart(data.faculty);
        updateRatingsChart(data.candidates.ratingDistribution);
    }

    // Load sample data as fallback
    function loadSampleData() {
        // Sample faculty data
        const facultyData = [
            { id: 1, name: "Dr. Sarah Johnson", email: "sjohnson@faculty.edu", interviewDate: "2025-05-10", scheduledCount: 8, lastLogin: "2025-04-16", created: "2023-09-05" },
            { id: 2, name: "Prof. Michael Chen", email: "mchen@faculty.edu", interviewDate: "2025-05-15", scheduledCount: 6, lastLogin: "2025-04-18", created: "2023-10-12" },
            { id: 3, name: "Dr. Amelia Rodriguez", email: "arodriguez@faculty.edu", interviewDate: null, scheduledCount: 0, lastLogin: "2025-04-17", created: "2024-01-08" },
            { id: 4, name: "Prof. James Williams", email: "jwilliams@faculty.edu", interviewDate: "2025-05-12", scheduledCount: 5, lastLogin: "2025-04-15", created: "2023-11-22" }
        ];

        // Sample interview data
        const interviewData = [
            { date: "2025-05-10", faculty: "Dr. Sarah Johnson", candidates: 8 },
            { date: "2025-05-12", faculty: "Prof. James Williams", candidates: 5 },
            { date: "2025-05-15", faculty: "Prof. Michael Chen", candidates: 6 }
        ];

        // Sample candidate data
        const candidateData = generateSampleCandidates();

        // Update faculty metrics
        const totalFaculty = facultyData.length;
        const scheduledFaculty = facultyData.filter(f => f.interviewDate !== null).length;
        const schedulingPercent = Math.round((scheduledFaculty / totalFaculty) * 100);

        // Update DOM elements with sample data
        document.getElementById('total-faculty').textContent = totalFaculty;
        document.getElementById('scheduled-faculty').textContent = scheduledFaculty;
        document.getElementById('scheduling-percent').textContent = schedulingPercent + '%';
        document.getElementById('total-candidates').textContent = candidateData.length;
        document.getElementById('faculty-count').textContent = totalFaculty;

        // Update progress bars
        document.getElementById('scheduled-progress').style.width = schedulingPercent + '%';
        document.getElementById('scheduled-progress').setAttribute('aria-valuenow', schedulingPercent);

        // Populate tables and grid with sample data
        populateFacultyTable(facultyData);
        populateCandidatesGrid(candidateData);
        populateUpcomingInterviewsTable(interviewData);
        document.getElementById('candidates-count').textContent = candidateData.length;

        // Update charts with sample data
        updateFacultyStatusChartWithSample();
        updateRatingsChartWithSample();
    }

    // Generate sample candidates
    function generateSampleCandidates() {
        const names = [
            "John Smith", "Emma Johnson", "Daniel Kim", "Sophia Martinez", "James Wilson",
            "Olivia Garcia", "Alexander Brown", "Ava Davis", "William Miller", "Isabella Jones",
            "Michael Lee", "Emily Wilson", "Benjamin Davis", "Grace White", "Ethan Taylor",
            "Charlotte Anderson", "Jacob Thomas", "Amelia Robinson", "Liam Harris", "Harper Scott"
        ];

        const interests = [
            ["Computer Science", "Data Science"],
            ["Mathematics", "Statistics"],
            ["Physics", "Engineering"],
            ["Chemistry", "Biology"],
            ["English Literature", "Creative Writing"]
        ];

        const candidates = [];

        for (let i = 0; i < 20; i++) {
            const randomRating = Math.random() > 0.15 ? (2 + Math.random() * 3).toFixed(1) : null;
            const randomInterests = interests[Math.floor(Math.random() * interests.length)];

            candidates.push({
                id: i + 1,
                name: names[i],
                avgRating: randomRating,
                interests: randomInterests,
                ratings: Math.floor(Math.random() * 5) + (randomRating ? 1 : 0)
            });
        }

        return candidates;
    }

    // Populate faculty table
    function populateFacultyTable(data) {
        const tableBody = document.getElementById('faculty-table-body');
        tableBody.innerHTML = '';

        data.forEach(faculty => {
            const row = document.createElement('tr');

            // Format the interview date
            const dateHtml = faculty.interviewDate
                ? `<span class="date-badge scheduled">${formatDate(faculty.interviewDate)}</span>`
                : `<span class="date-badge not-scheduled">Not Scheduled</span>`;

            row.innerHTML = `
                <td>
                    <div class="d-flex align-items-center">
                        <div class="me-3">
                            <div class="avatar bg-secondary text-white rounded-circle d-flex align-items-center justify-content-center"
                                style="width:40px; height:40px; font-weight:500">
                                ${getInitials(faculty.name)}
                            </div>
                        </div>
                        <div>
                            <h6 class="mb-0">${faculty.name}</h6>
                        </div>
                    </div>
                </td>
                <td>${faculty.email}</td>
                <td>${dateHtml}</td>
                <td>
                    <span class="fw-medium ${faculty.scheduledCount > 0 ? 'text-success' : 'text-muted'}">${faculty.scheduledCount}</span>
                </td>
                <td class="text-center">
                    <button class="btn btn-sm btn-outline-secondary view-faculty-btn" data-id="${faculty.id}">
                        <i class="fas fa-eye me-1"></i> View
                    </button>
                </td>
            `;

            tableBody.appendChild(row);
        });

        // Add event listeners to view buttons
        document.querySelectorAll('.view-faculty-btn').forEach(button => {
            button.addEventListener('click', function() {
                const facultyId = parseInt(this.dataset.id);
                openFacultyModal(facultyId, data);
            });
        });
    }

    // Populate candidates grid
    function populateCandidatesGrid(data) {
        const container = document.getElementById('candidates-container');
        container.innerHTML = '';

        if (!data || data.length === 0) {
            container.innerHTML = `
                <div class="col-12 text-center py-4">
                    <p class="text-muted mb-0">No candidates found</p>
                </div>
            `;
            return;
        }

        data.forEach(candidate => {
            const col = document.createElement('div');
            col.className = 'col-xl-3 col-lg-4 col-md-6 mb-3';
            col.dataset.rating = candidate.avgRating || 0;

            // Calculate rating class
            let ratingClass = 'secondary';
            let ratingBadgeClass = '';
            if (candidate.avgRating) {
                const rating = parseFloat(candidate.avgRating);
                if (rating >= 4) {
                    ratingClass = 'success';
                    ratingBadgeClass = 'high';
                } else if (rating >= 3) {
                    ratingClass = 'warning';
                    ratingBadgeClass = 'medium';
                } else {
                    ratingClass = 'danger';
                    ratingBadgeClass = 'low';
                }
            }

            // Generate stars HTML
            const starsHtml = candidate.avgRating
                ? generateRatingStars(candidate.avgRating)
                : '<span class="text-muted">Not rated</span>';

            // Generate interests badges
            const interestsHtml = candidate.interests && candidate.interests.length > 0
                ? candidate.interests.map(interest =>
                    `<span class="badge bg-light text-secondary me-1 mb-1">${interest}</span>`).join('')
                : '<span class="text-muted fst-italic">No interests listed</span>';

            col.innerHTML = `
                <div class="card h-100 student-card" data-id="${candidate.id}">
                    <div class="card-body p-3">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div class="d-flex align-items-center">
                                <div class="me-2">
                                    <div class="avatar bg-${ratingClass} text-white rounded-circle d-flex align-items-center justify-content-center"
                                        style="width:42px; height:42px; font-weight:500">
                                        ${getInitials(candidate.name)}
                                    </div>
                                </div>
                                <div>
                                    <h6 class="mb-0 text-truncate" style="max-width: 150px;">${candidate.name}</h6>
                                    <small class="text-muted">ID: ${candidate.id}</small>
                                </div>
                            </div>
                            <div>
                                ${candidate.avgRating
                                    ? `<span class="rating-badge bg-${ratingClass} bg-opacity-10 text-${ratingClass}">${candidate.avgRating} <i class="fas fa-star"></i></span>`
                                    : ''}
                            </div>
                        </div>
                        <div class="mb-3 rating-stars">
                            ${starsHtml}
                        </div>
                        <div class="small text-muted mb-2">Interests:</div>
                        <div class="mb-2">
                            ${interestsHtml}
                        </div>
                        <div class="mt-3 d-flex justify-content-between align-items-center">
                            <span class="small text-muted">${candidate.ratings} ${candidate.ratings === 1 ? 'rating' : 'ratings'}</span>
                            <button class="btn btn-sm btn-outline-secondary view-candidate-btn">
                                <i class="fas fa-eye me-1"></i> View
                            </button>
                        </div>
                    </div>
                </div>
            `;

            container.appendChild(col);
        });

        // Add event listeners to view buttons
        document.querySelectorAll('.view-candidate-btn').forEach(button => {
            button.addEventListener('click', function() {
                const candidateCard = this.closest('.student-card');
                const candidateId = parseInt(candidateCard.dataset.id);
                openCandidateModal(candidateId, data);
            });
        });
    }

    // Filter candidates by search term
    function filterCandidates(searchTerm) {
        const candidateCards = document.querySelectorAll('.student-card');
        let visibleCount = 0;

        candidateCards.forEach(card => {
            const parent = card.parentElement;
            const candidateName = card.querySelector('h6').textContent.toLowerCase();

            if (candidateName.includes(searchTerm)) {
                parent.style.display = '';
                visibleCount++;
            } else {
                parent.style.display = 'none';
            }
        });

        document.getElementById('candidates-count').textContent = visibleCount;
    }

    // Filter candidates by rating
    function filterCandidatesByRating(filter) {
        const candidateCards = document.querySelectorAll('.student-card');
        let visibleCount = 0;

        candidateCards.forEach(card => {
            const parent = card.parentElement;
            const rating = parseFloat(parent.dataset.rating || 0);

            let show = false;

            switch(filter) {
                case 'all':
                    show = true;
                    break;
                case 'high':
                    show = rating >= 4;
                    break;
                case 'medium':
                    show = rating >= 3 && rating < 4;
                    break;
                case 'low':
                    show = rating > 0 && rating < 3;
                    break;
                case 'unrated':
                    show = rating === 0;
                    break;
            }

            if (show) {
                parent.style.display = '';
                visibleCount++;
            } else {
                parent.style.display = 'none';
            }
        });

        document.getElementById('candidates-count').textContent = visibleCount;
    }

    // Load more candidates
    function loadMoreCandidates() {
        // In a real application, this would load the next page of candidates
        // For demo purposes, we'll just show a toast message
        showToast('Loading more candidates...', 'info');

        setTimeout(() => {
            // Add some more sample candidates
            const container = document.getElementById('candidates-container');
            const currentCount = container.querySelectorAll('.student-card').length;
            const moreCandidates = generateSampleCandidates().slice(0, 4);

            // Update the display
            populateCandidatesGrid([...moreCandidates]);

            // Update count
            document.getElementById('candidates-count').textContent =
                parseInt(document.getElementById('candidates-count').textContent) + moreCandidates.length;

            showToast('More candidates loaded', 'success');
        }, 1000);
    }

    // Populate upcoming interviews table
    function populateUpcomingInterviewsTable(data) {
        const tableBody = document.getElementById('upcoming-interviews-body');
        tableBody.innerHTML = '';

        if (!data || data.length === 0) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="4" class="text-center py-4">
                        <p class="text-muted mb-0">No upcoming interviews scheduled</p>
                    </td>
                </tr>
            `;
            return;
        }

        // Sort interviews by date
        const sortedInterviews = [...data].sort((a, b) => new Date(a.date) - new Date(b.date));

        sortedInterviews.forEach(interview => {
            const row = document.createElement('tr');

            row.innerHTML = `
                <td>
                    <div class="d-flex align-items-center">
                        <div class="me-2 text-secondary">
                            <i class="fas fa-calendar-day"></i>
                        </div>
                        <div>
                            <h6 class="mb-0">${formatDate(interview.date)}</h6>
                            <small class="text-muted">${getDayOfWeek(interview.date)}</small>
                        </div>
                    </div>
                </td>
                <td>${interview.faculty}</td>
                <td>
                    <div class="d-flex align-items-center">
                        <span class="rating-pill high">
                            <i class="fas fa-users me-1"></i> ${interview.candidates}
                        </span>
                    </div>
                </td>
                <td>
                    <button class="btn btn-sm btn-outline-secondary">
                        <i class="fas fa-clipboard-list me-1"></i> View Schedule
                    </button>
                </td>
            `;

            tableBody.appendChild(row);
        });
    }

    // Open faculty details modal
    function openFacultyModal(facultyId, facultyDataArray) {
        // Find the faculty member
        const faculty = facultyDataArray.find(f => f.id === facultyId);
        if (!faculty) return;

        // Update modal content
        document.getElementById('faculty-modal-name').textContent = faculty.name;
        document.getElementById('modal-faculty-email').textContent = faculty.email;
        document.getElementById('modal-faculty-id').textContent = faculty.id;
        document.getElementById('modal-last-login').textContent = formatDate(faculty.lastLogin) || 'N/A';
        document.getElementById('modal-created-date').textContent = formatDate(faculty.created) || 'N/A';

        // Schedule status
        const scheduleStatusEl = document.getElementById('modal-schedule-status');
        if (faculty.interviewDate) {
            scheduleStatusEl.innerHTML = `
                <div class="d-flex align-items-center p-3 rounded-3 bg-success bg-opacity-10">
                    <div class="icon me-3 bg-success bg-opacity-20 text-success p-2 rounded-circle">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div>
                        <h6 class="mb-1 fw-bold text-success">Interview Date Scheduled</h6>
                        <p class="mb-0">${formatDate(faculty.interviewDate)} (${getDayOfWeek(faculty.interviewDate)})</p>
                    </div>
                </div>
            `;
        } else {
            scheduleStatusEl.innerHTML = `
                <div class="d-flex align-items-center p-3 rounded-3 bg-warning bg-opacity-10">
                    <div class="icon me-3 bg-warning bg-opacity-20 text-warning p-2 rounded-circle">
                        <i class="fas fa-calendar-xmark"></i>
                    </div>
                    <div>
                        <h6 class="mb-1 fw-bold text-warning">No Interview Date Set</h6>
                        <p class="mb-0">This faculty has not scheduled interview dates yet.</p>
                    </div>
                </div>
            `;
        }

        // Candidates list (mock data for demo)
        const candidatesListEl = document.getElementById('modal-candidates-list');
        if (faculty.scheduledCount > 0) {
            candidatesListEl.innerHTML = '';

            // Create sample scheduled candidates based on the count
            for (let i = 0; i < faculty.scheduledCount; i++) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>Candidate ${i+1}</td>
                    <td>Sample Course ${i+1}</td>
                `;
                candidatesListEl.appendChild(row);
            }
        } else {
            candidatesListEl.innerHTML = `
                <tr>
                    <td colspan="2" class="text-center py-3">
                        <p class="text-muted mb-0">No candidates scheduled</p>
                    </td>
                </tr>
            `;
        }

        // Show the modal
        const modal = new bootstrap.Modal(document.getElementById('facultyDetailsModal'));
        modal.show();
    }

    // Open candidate details modal
    function openCandidateModal(candidateId, candidateDataArray) {
        // Find the candidate
        const candidate = candidateDataArray.find(c => c.id === candidateId);
        if (!candidate) return;

        // Update modal content
        document.getElementById('candidate-modal-name').textContent = candidate.name;
        document.getElementById('modal-candidate-id').textContent = candidate.id;

        const ratingHtml = candidate.avgRating
            ? `<span class="fw-bold">${candidate.avgRating}</span> <span class="rating-stars">${generateRatingStars(candidate.avgRating)}</span> (${candidate.ratings} ${candidate.ratings === 1 ? 'rating' : 'ratings'})`
            : 'Not yet rated';
        document.getElementById('modal-candidate-rating').innerHTML = ratingHtml;

        // Interests
        const interestsEl = document.getElementById('modal-candidate-interests');
        if (candidate.interests && candidate.interests.length > 0) {
            interestsEl.innerHTML = candidate.interests.map(interest =>
                `<span class="badge bg-secondary bg-opacity-10 text-secondary p-2 me-1 mb-1">${interest}</span>`
            ).join('');
        } else {
            interestsEl.innerHTML = '<p class="text-muted mb-0">No interests listed</p>';
        }

        // Ratings list (mock data for demo)
        const ratingsListEl = document.getElementById('modal-ratings-list');
        if (candidate.ratings > 0) {
            ratingsListEl.innerHTML = '';

            // Create sample ratings based on the count
            const facultyNames = ["Dr. Sarah Johnson", "Prof. Michael Chen", "Dr. Amelia Rodriguez", "Prof. James Williams"];

            for (let i = 0; i < candidate.ratings; i++) {
                // Randomly generate a rating between 1 and 5 stars that averages to the candidate's avgRating
                const randomRating = Math.max(1, Math.min(5,
                    parseFloat(candidate.avgRating) + (Math.random() * 1.5 - 0.75)
                )).toFixed(1);

                // Random faculty name
                const facultyName = facultyNames[Math.floor(Math.random() * facultyNames.length)];

                // Random comment
                const comments = [
                    "Strong candidate with good potential.",
                    "Shows excellent knowledge in the field.",
                    "Good communication skills, but needs improvement in technical areas.",
                    "Impressive background, recommended for interview.",
                    "Average performance, could improve with more experience."
                ];
                const comment = randomRating >= 3.5 ?
                    comments[Math.floor(Math.random() * 2)] :
                    comments[Math.floor(Math.random() * comments.length)];

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${facultyName}</td>
                    <td>${generateRatingStars(randomRating)}</td>
                    <td>${comment}</td>
                `;
                ratingsListEl.appendChild(row);
            }
        } else {
            ratingsListEl.innerHTML = `
                <tr>
                    <td colspan="3" class="text-center py-3">
                        <p class="text-muted mb-0">No ratings yet</p>
                    </td>
                </tr>
            `;
        }

        // Schedule information (mock data)
        const scheduleEl = document.getElementById('modal-candidate-schedule');
        // 40% chance of having a schedule if rated highly
        const hasSchedule = candidate.avgRating && parseFloat(candidate.avgRating) >= 3.8 && Math.random() > 0.6;

        if (hasSchedule) {
            // Random interview date in the next 2 weeks
            const randomDays = Math.floor(Math.random() * 14) + 1;
            const interviewDate = new Date();
            interviewDate.setDate(interviewDate.getDate() + randomDays);

            // Random faculty
            const facultyNames = ["Dr. Sarah Johnson", "Prof. Michael Chen", "Prof. James Williams"];
            const facultyName = facultyNames[Math.floor(Math.random() * facultyNames.length)];

            scheduleEl.innerHTML = `
                <div class="d-flex align-items-center p-3 rounded-3 bg-success bg-opacity-10">
                    <div class="icon me-3 bg-success bg-opacity-20 text-success p-2 rounded-circle">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div>
                        <h6 class="mb-1 fw-bold text-success">Interview Scheduled</h6>
                        <p class="mb-1"><strong>Date:</strong> ${formatDate(interviewDate)} (${getDayOfWeek(interviewDate)})</p>
                        <p class="mb-0"><strong>Faculty:</strong> ${facultyName}</p>
                    </div>
                </div>
            `;
        } else {
            scheduleEl.innerHTML = `
                <div class="d-flex align-items-center p-3 rounded-3 bg-secondary bg-opacity-10">
                    <div class="icon me-3 bg-secondary bg-opacity-20 text-secondary p-2 rounded-circle">
                        <i class="fas fa-calendar-xmark"></i>
                    </div>
                    <div>
                        <h6 class="mb-1 fw-bold text-secondary">Not Scheduled</h6>
                        <p class="mb-0">This candidate has not been scheduled for interviews yet.</p>
                    </div>
                </div>
            `;
        }

        // View documents button event
        document.getElementById('view-candidate-documents').addEventListener('click', function() {
            showToast('Opening candidate documents...', 'info');
            setTimeout(() => {
                showToast('Documents opened in new tab', 'success');
            }, 1000);
        });

        // Show the modal
        const modal = new bootstrap.Modal(document.getElementById('candidateDetailsModal'));
        modal.show();
    }

    // Filter faculty table based on search
    function filterFacultyTable(searchTerm) {
        const rows = document.querySelectorAll('#faculty-table-body tr');
        let visibleCount = 0;

        rows.forEach(row => {
            const facultyName = row.querySelector('td:first-child h6')?.textContent.toLowerCase() || '';
            const facultyEmail = row.querySelector('td:nth-child(2)')?.textContent.toLowerCase() || '';

            if (facultyName.includes(searchTerm) || facultyEmail.includes(searchTerm)) {
                row.style.display = '';
                visibleCount++;
            } else {
                row.style.display = 'none';
            }
        });

        document.getElementById('faculty-count').textContent = visibleCount;
    }

    // Initialize charts
    let facultyStatusChart = null;
    let ratingsChart = null;

    function initCharts() {
        // Faculty status chart
        const facultyStatusCtx = document.getElementById('faculty-status-chart').getContext('2d');
        facultyStatusChart = new Chart(facultyStatusCtx, {
            type: 'doughnut',
            data: {
                labels: ['Scheduled', 'Not Scheduled'],
                datasets: [{
                    data: [0, 0],
                    backgroundColor: [
                        '#236465', // Scheduled (secondary color)
                        '#c95659'  // Not Scheduled (primary color)
                    ],
                    borderColor: 'white',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '65%',
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            usePointStyle: true,
                            pointStyle: 'circle'
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.formattedValue || '';
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = total > 0 ? ((context.raw / total) * 100).toFixed(1) : 0;
                                return `${label}: ${value} (${percentage}%)`;
                            }
                        }
                    }
                }
            }
        });

        // Ratings distribution chart
        const ratingsCtx = document.getElementById('ratings-chart').getContext('2d');
        ratingsChart = new Chart(ratingsCtx, {
            type: 'bar',
            data: {
                labels: ['1 Star', '2 Stars', '3 Stars', '4 Stars', '5 Stars'],
                datasets: [{
                    label: 'Number of Candidates',
                    data: [0, 0, 0, 0, 0],
                    backgroundColor: [
                        'rgba(173, 66, 69, 0.2)',
                        'rgba(173, 66, 69, 0.4)',
                        'rgba(173, 66, 69, 0.6)',
                        'rgba(173, 66, 69, 0.8)',
                        'rgba(173, 66, 69, 1.0)'
                    ],
                    borderColor: [
                        'rgb(173, 66, 69)',
                        'rgb(173, 66, 69)',
                        'rgb(173, 66, 69)',
                        'rgb(173, 66, 69)',
                        'rgb(173, 66, 69)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            precision: 0
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    }

    // Update faculty status chart with API data
    function updateFacultyStatusChart(facultyData) {
        if (!facultyStatusChart) return;

        const scheduledCount = facultyData.scheduled;
        const notScheduledCount = facultyData.total - facultyData.scheduled;

        facultyStatusChart.data.datasets[0].data = [scheduledCount, notScheduledCount];
        facultyStatusChart.update();
    }

    // Update faculty status chart with sample data
    function updateFacultyStatusChartWithSample() {
        if (!facultyStatusChart) return;

        const scheduledCount = 5;
        const notScheduledCount = 3;

        facultyStatusChart.data.datasets[0].data = [scheduledCount, notScheduledCount];
        facultyStatusChart.update();
    }

    // Update ratings chart with API data
    function updateRatingsChart(distributionData) {
        if (!ratingsChart) return;

        ratingsChart.data.labels = distributionData.labels;
        ratingsChart.data.datasets[0].data = distributionData.data;
        ratingsChart.update();
    }

    // Update ratings chart with sample data
    function updateRatingsChartWithSample() {
        if (!ratingsChart) return;

        const ratingDistribution = [1, 3, 7, 12, 8]; // Sample data
        ratingsChart.data.datasets[0].data = ratingDistribution;
        ratingsChart.update();
    }

    // Utility Functions

    // Format date string
    function formatDate(dateString) {
        if (!dateString) return 'Not Set';

        try {
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return 'Invalid Date';

            return new Intl.DateTimeFormat('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            }).format(date);
        } catch (error) {
            console.error('Error formatting date:', error);
            return dateString; // Return original string if parsing fails
        }
    }

    // Get day of week
    function getDayOfWeek(dateString) {
        if (!dateString) return '';

        try {
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return '';

            return new Intl.DateTimeFormat('en-US', { weekday: 'long' }).format(date);
        } catch (error) {
            console.error('Error getting day of week:', error);
            return '';
        }
    }

    // Get initials from name
    function getInitials(name) {
        if (!name) return '';

        return name
            .split(' ')
            .map(part => part.charAt(0))
            .join('')
            .toUpperCase();
    }

    // Generate rating stars HTML
    function generateRatingStars(rating) {
        const fullStars = Math.floor(rating);
        const halfStar = rating % 1 >= 0.5;
        const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);

        let starsHtml = '';

        // Full stars
        for (let i = 0; i < fullStars; i++) {
            starsHtml += '<i class="fas fa-star text-warning"></i>';
        }

        // Half star
        if (halfStar) {
            starsHtml += '<i class="fas fa-star-half-alt text-warning"></i>';
        }

        // Empty stars
        for (let i = 0; i < emptyStars; i++) {
            starsHtml += '<i class="far fa-star text-muted"></i>';
        }

        return starsHtml;
    }

    // Get rating class based on rating value
    function getRatingClass(rating) {
        if (rating >= 4) return 'high';
        if (rating >= 3) return 'medium';
        return 'low';
    }

    // Show toast notification
    function showToast(message, type = 'success') {
        // Create toast container if it doesn't exist
        let toastContainer = document.getElementById('toast-container');
        if (!toastContainer) {
            toastContainer = document.createElement('div');
            toastContainer.id = 'toast-container';
            toastContainer.className = 'position-fixed bottom-0 end-0 p-3';
            document.body.appendChild(toastContainer);
        }

        // Create toast element
        const toastId = 'toast-' + Date.now();
        const toast = document.createElement('div');
        toast.id = toastId;
        toast.className = `toast align-items-center text-white border-0`;
        toast.setAttribute('role', 'alert');
        toast.setAttribute('aria-live', 'assertive');
        toast.setAttribute('aria-atomic', 'true');

        // Set appropriate background class
        switch(type) {
            case 'success':
                toast.classList.add('bg-success');
                break;
            case 'error':
                toast.classList.add('bg-danger');
                break;
            case 'warning':
                toast.classList.add('bg-warning');
                break;
            case 'info':
                toast.classList.add('bg-info');
                break;
            default:
                toast.classList.add('bg-dark');
        }

        // Icon based on type
        let icon;
        switch(type) {
            case 'success':
                icon = 'check-circle';
                break;
            case 'error':
                icon = 'times-circle';
                break;
            case 'warning':
                icon = 'exclamation-triangle';
                break;
            case 'info':
                icon = 'info-circle';
                break;
            default:
                icon = 'bell';
        }

        toast.innerHTML = `
            <div class="d-flex">
                <div class="toast-body">
                    <i class="fas fa-${icon} me-2"></i> ${message}
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        `;

        toastContainer.appendChild(toast);

        // Initialize and show toast
        const bsToast = new bootstrap.Toast(toast, {
            autohide: true,
            delay: 3000
        });
        bsToast.show();

        // Remove the toast after it's hidden
        toast.addEventListener('hidden.bs.toast', function() {
            if (toastContainer.contains(toast)) {
                toastContainer.removeChild(toast);
            }
        });
    }

    // Export faculty report as PDF
    function exportFacultyReport() {
        // Show loading toast
        showToast('Generating PDF report...', 'info');

        // In a production environment, this would call an API endpoint
        // For demonstration, we'll simulate the export with a delay
        setTimeout(() => {
            // Create a simple export using html2pdf.js library
            // Note: In a real implementation, you would include html2pdf.js or use a server-side PDF generation

            // Create content to export
            const reportContent = document.createElement('div');
            reportContent.innerHTML = `
                <div style="padding: 20px; font-family: Arial, sans-serif;">
                    <h2 style="color: #AD4245;">Faculty Instructor Report</h2>
                    <p style="color: #666;">Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}</p>
                    <hr>
                    <h3 style="color: #236465;">Overview Statistics</h3>
                    <p><strong>Total Faculty:</strong> ${document.getElementById('total-faculty').textContent}</p>
                    <p><strong>Faculty with Schedules:</strong> ${document.getElementById('scheduled-faculty').textContent}</p>
                    <p><strong>Scheduling Rate:</strong> ${document.getElementById('scheduling-percent').textContent}</p>
                    <p><strong>Total Candidates:</strong> ${document.getElementById('total-candidates').textContent}</p>
                    <hr>
                    <h3 style="color: #236465;">Faculty List</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background-color: #f2f2f2;">
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Name</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Email</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Interview Date</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Scheduled Candidates</th>
                            </tr>
                        </thead>
                        <tbody id="report-faculty-list">
                        </tbody>
                    </table>

                    <h3 style="color: #236465; margin-top: 20px;">Top Rated Candidates</h3>
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background-color: #f2f2f2;">
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Name</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Average Rating</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 1px solid #ddd;">Interests</th>
                            </tr>
                        </thead>
                        <tbody id="report-candidate-list">
                        </tbody>
                    </table>
                </div>
            `;

            // Add faculty data to the report
            const reportFacultyList = reportContent.querySelector('#report-faculty-list');
            document.querySelectorAll('#faculty-table-body tr').forEach(row => {
                const newRow = document.createElement('tr');

                // Get faculty name
                const nameCell = row.querySelector('td:first-child');
                const name = nameCell ? nameCell.querySelector('h6').textContent : 'N/A';

                // Get email, date, and scheduled count
                const email = row.querySelector('td:nth-child(2)') ? row.querySelector('td:nth-child(2)').textContent : 'N/A';
                const date = row.querySelector('td:nth-child(3) span') ? row.querySelector('td:nth-child(3) span').textContent : 'N/A';
                const scheduledCount = row.querySelector('td:nth-child(4)') ? row.querySelector('td:nth-child(4)').textContent : '0';

                newRow.innerHTML = `
                    <td style="padding: 10px; border-bottom: 1px solid #ddd;">${name}</td>
                    <td style="padding: 10px; border-bottom: 1px solid #ddd;">${email}</td>
                    <td style="padding: 10px; border-bottom: 1px solid #ddd;">${date}</td>
                    <td style="padding: 10px; border-bottom: 1px solid #ddd;">${scheduledCount}</td>
                `;

                reportFacultyList.appendChild(newRow);
            });

            // Add top candidate data to the report
            const reportCandidateList = reportContent.querySelector('#report-candidate-list');
            // Get only visible candidates with high ratings
            const highRatedCandidates = Array.from(document.querySelectorAll('.student-card'))
                .filter(card => {
                    const rating = parseFloat(card.closest('[data-rating]').dataset.rating || 0);
                    return rating >= 4;
                })
                .slice(0, 5); // Get top 5

            highRatedCandidates.forEach(card => {
                const newRow = document.createElement('tr');
                const name = card.querySelector('h6').textContent;
                const rating = card.querySelector('.rating-badge') ?
                    card.querySelector('.rating-badge').textContent.trim() : 'N/A';
                const interests = Array.from(card.querySelectorAll('.badge'))
                    .map(badge => badge.textContent)
                    .join(', ');

                newRow.innerHTML = `
                    <td style="padding: 10px; border-bottom: 1px solid #ddd;">${name}</td>
                    <td style="padding: 10px; border-bottom: 1px solid #ddd;">${rating}</td>
                    <td style="padding: 10px; border-bottom: 1px solid #ddd;">${interests}</td>
                `;

                reportCandidateList.appendChild(newRow);
            });

            // In a real implementation, you would use html2pdf or another library
            // html2pdf().from(reportContent).save('faculty_report.pdf');

            // For demo, we'll create a data URL and open it in a new tab
            const blob = new Blob([reportContent.outerHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            window.open(url, '_blank');

            showToast('Report exported successfully!', 'success');
        }, 1500);
    }

    // Send email to faculty
    function sendEmailToFaculty(facultyEmail, facultyName) {
        // Show loading toast
        showToast('Preparing email...', 'info');

        // In a production environment, this would call an API endpoint
        // For demonstration, we'll simulate sending an email with a delay
        setTimeout(() => {
            // Create modal for composing email
            const modalHtml = `
                <div class="modal fade" id="emailModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content border-0 shadow">
                            <div class="modal-header py-3" style="background: linear-gradient(to right, var(--secondary), #307f80); color: white;">
                                <h5 class="modal-title fw-bold">Send Email to ${facultyName}</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body p-4">
                                <div class="mb-3">
                                    <label for="email-to" class="form-label text-secondary">To:</label>
                                    <input type="email" class="form-control" id="email-to" value="${facultyEmail}" readonly>
                                </div>
                                <div class="mb-3">
                                    <label for="email-subject" class="form-label text-secondary">Subject:</label>
                                    <input type="text" class="form-control" id="email-subject" value="Faculty Interview Schedule - Update">
                                </div>
                                <div class="mb-3">
                                    <label for="email-body" class="form-label text-secondary">Message:</label>
                                    <textarea class="form-control" id="email-body" rows="6">Dear ${facultyName},

I hope this email finds you well. I'm writing to follow up on your faculty interview schedule for the upcoming hiring cycle.

Could you please confirm if you're available on your currently scheduled date? If you need to make any changes, please let us know as soon as possible.

Thank you for your participation in our hiring process.

Best regards,
Admin Team</textarea>
                                </div>
                            </div>
                            <div class="modal-footer border-0">
                                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-premium" id="send-email-btn">
                                    <i class="fas fa-paper-plane me-1"></i> Send Email
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Add modal to the DOM
            const modalContainer = document.createElement('div');
            modalContainer.innerHTML = modalHtml;
            document.body.appendChild(modalContainer);

            // Initialize the modal
            const emailModal = new bootstrap.Modal(document.getElementById('emailModal'));
            emailModal.show();

            // Add event listener to send button
            document.getElementById('send-email-btn').addEventListener('click', function() {
                // Simulate sending email
                emailModal.hide();

                // Show loading toast
                showToast('Sending email...', 'info');

                // Simulate delay
                setTimeout(() => {
                    showToast('Email sent successfully to ' + facultyEmail, 'success');

                    // Remove modal from DOM after it's hidden
                    document.getElementById('emailModal').addEventListener('hidden.bs.modal', function() {
                        modalContainer.remove();
                    });
                }, 1500);
            });
        }, 500);
    }
</script>
{% endblock %}